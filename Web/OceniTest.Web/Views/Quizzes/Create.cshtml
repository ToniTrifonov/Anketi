@model OceniTest.Web.ViewModels.Quizzes.CreateQuizInputModel
@{
    this.ViewData["Title"] = "Create Quiz";
    var categories = this.Model.Categories.Select(x => new SelectListItem(x.Value, x.Key));
}

<h1>@this.ViewData["Title"]</h1>

<div>
    <form id="createSurveyForm" method="post">
        <div class="alert-danger" asp-validation-summary="All"></div>

        <div class="col-md-6">
            <label asp-for="Name"></label>
            <input asp-for="Name" />
            <span asp-validation-for="Name" class="alert-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Title"></label>
            <input asp-for="Title" />
            <span asp-validation-for="Title" class="alert-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Description"></label>
            <textarea asp-for="Description"></textarea>
            <span asp-validation-for="Description" class="alert-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="CategoryId"></label>
            <select asp-for="CategoryId" asp-items="categories">
            </select>
        </div>

        <button id="addQuestionButton">Add Question</button>

        <div id="questionsContainer">
            <table>
                <tbody>
                </tbody>
            </table>
        </div>

        <input type="submit" asp-action="Create" />
    </form>
</div>

<script type="text/javascript">
    var questionsCount = 0;

    function AddQuestion() {
        document.getElementById('addQuestionButton').addEventListener('click', function (event) {
            event.preventDefault();

            var element = document.createElement('tr');
            element.innerHTML =
                `<td><div><strong>Q${questionsCount + 1}.</strong></div></td><td><div><textarea type="text" name="Questions[${questionsCount}].Description" placeholder="Enter your question here"></textarea></div></td><button class="btn btn-danger">Remove</button><button class="btn btn-success">+</button>`;
            element.setAttribute('id', `${questionsCount}`);

            document.querySelector('#questionsContainer table tbody').appendChild(element);

            questionsCount++;
        })
    }

    function HandleEvents() {
        document.getElementById('questionsContainer').addEventListener('click', function (event) {
            event.preventDefault();

            if (event.target.textContent == 'Remove') {
                var elementToRemove = event.target.parentNode;  
                document.querySelector('#questionsContainer table tbody').removeChild(elementToRemove);
                var questionNumber = elementToRemove.getAttribute('id');

                [...document.querySelectorAll('#questionsContainer table tbody tr')]
                    .filter(question => question.getAttribute('id') > questionNumber)
                    .map(question => {
                        question.setAttribute('id', question.getAttribute('id') - 1);
                        question.querySelector('td div strong').textContent = `Q${Number(question.getAttribute('id')) + 1}`;
                    });

                questionsCount--;
            } else if (event.target.textContent == '+') {
                var element = document.createElement('textarea');
                element.setAttribute('placeholder', 'Enter answer option here...');

                event.target.parentNode.appendChild(element);
            }
        })
    }

    AddQuestion();
    HandleEvents();
</script>
